# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is **jjstatsplot**, an R package that wraps [ggstatsplot](https://indrajeetpatil.github.io/ggstatsplot/) functions for use as a module in [jamovi](https://www.jamovi.org). It provides point-and-click statistical visualizations through jamovi's GUI while maintaining R's statistical power.

## Architecture

### Three-Layer jamovi Integration

Each analysis follows a consistent pattern:
- `R/jj[name].b.R` - R6 class implementing backend logic
- `R/jj[name].h.R` - Auto-generated helper classes (do not edit manually)
- `jamovi/jj[name].a.yaml` - Analysis definition (parameters, options)
- `jamovi/jj[name].u.yaml` - User interface definition
- `jamovi/jj[name].r.yaml` - Results definition

### R6 Class Structure

Each backend class inherits from `jj[name]Base` â†’ `jmvcore::Analysis` and implements:
- `.init()` - Setup plot dimensions and grouping logic
- `.run()` - Main analysis with error handling and data validation
- `.plot()` - Primary plot using ggstatsplot functions
- `.plot2()` - Secondary grouped plots (when grouping variable specified)

### Dual-Mode Operation

All analyses support:
- **Simple Mode**: Single dependent variable analysis
- **Grouped Mode**: Multiple dependent variables or grouping by factor
- Logic checks `length(self$options$dep)` and `!is.null(self$options$grvar)`

## Development Commands

### Standard R Package Development
```r
# Generate documentation
devtools::document()

# Check package compliance
devtools::check()

# Install locally
devtools::install()

# Load for development
devtools::load_all()
```

### Testing
```r
# Run R CMD check (GitHub Actions uses this)
rcmdcheck::rcmdcheck()
```

### jamovi Module Development
- The `.h.R` files are auto-generated by jamovi compiler from `.yaml` files
- Never edit `.h.R` files manually
- After modifying `.yaml` files, jamovi will regenerate `.h.R` files
- Main module definition is in `jamovi/0000.yaml`

## Package Dependencies

**Core Framework:**
- `jmvcore` (jamovi core)
- `R6` (OOP system)
- `ggstatsplot` (main statistical plotting engine)

**Key Plotting:**
- `ggplot2`, `ggalluvial`, `ggside`, `ggcorrplot`
- `waffle` (for waffle charts)

**Statistical:**
- `PMCMRplus`, `WRS2`, `BayesFactor`, `effectsize`, `performance`

## Analysis Types

1. **jjhistostats** - Histograms with statistical annotations
2. **jjscatterstats** - Scatter plots with regression details  
3. **jjcorrmat** - Correlation matrices
4. **jjbetweenstats** - Between-groups comparisons (box-violin plots)
5. **jjdotplotstats** - Dot charts with summary statistics
6. **jjbarstats** - Bar charts for categorical data
7. **jjpiestats** - Pie charts
8. **jjwithinstats** - Within-groups comparisons (repeated measures)
9. **waffle** - Waffle charts for distributions

## Key Patterns

### Plot Size Management
```r
# In .init(), set dynamic plot sizes based on data
deplen <- length(self$options$dep)
self$results$plot$setSize(600, deplen * 450)

# For grouped plots
num_levels <- nlevels(as.factor(mydata[[grvar]]))
self$results$plot2$setSize(num_levels * 600, deplen * 450)
```

### Error Handling
- Always check for required variables before running analysis
- Use `glue::glue()` for user-friendly error messages
- Return early with helpful guidance when data is missing

### Theme Support
- Supports both jamovi-style themes and original ggstatsplot themes
- Theme selection handled through jamovi UI options

## File Organization

- **R/** - All R source code
- **jamovi/** - jamovi analysis definitions and UI
- **man/** - Generated documentation (roxygen2)
- **data/** - Example datasets (histopathology.rda)
- **vignettes/** - Package tutorials
- **inst/i18n/** - Internationalization support

## Testing Strategy

The package uses GitHub Actions with R-CMD-check on macOS and Windows. Tests automatically skip for commits containing "WIP" in the message.